{% extends 'base.html' %}

{% block content %}

<div class="container vh-100">
    <h1>{% block title %} Create new reservation {% endblock %}</h1>

    <form method="post">

        <div class="form-group">
            <label for="target">Target</label>
            <select name="target" class="form-control">
                <option {% if session['target']=='rest-bfsw01' %}selected{% endif %}>rest-bfsw01</option>
                <option {% if session['target']=='rest-bfsw02' %}selected{% endif %}>rest-bfsw02</option>
            </select>
        </div>


        <div class="form-group">
            <label for="datetimepicker1">From:</label>
            <div class="input-group date" id="datetimepicker1" data-target-input="nearest">
                <!-- <input type="text" name="datetime" class="form-control datetimepicker-input" data-target="#datetimepicker1"/> -->
                <input type="text" name="from" class="form-control" />
                <div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>


        <div class="form-group">
            <label for="datetimepicker2">To:</label>
            <div class="input-group date" id="datetimepicker2" data-target-input="nearest">
                <!-- <input type="text" name="datetime" class="form-control datetimepicker-input" data-target="#datetimepicker1"/> -->
                <input type="text" name="to" class="form-control" />
                <div class="input-group-append" data-target="#datetimepicker2" data-toggle="datetimepicker">
                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                </div>
            </div>
        </div>

        <div class="form-group">
            <button type="submit" name="check" class="btn btn-primary">Check availability</button>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="form-group">
            {% for cat, message in messages %}
            <div class="alert alert-{{ cat }}" role="alert">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

    </form>

    {% if show_rsvp %}
    <h4>Active reservations</h4>
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Username</th>
                <th scope="col">Target</th>
                <th scope="col">From</th>
                <th scope="col">To</th>
            </tr>
        </thead>
        <tbody>
            {% for rsvp in reservations %}
            <tr>
                <td>{{ rsvp.username }}</td>
                <td>{{ rsvp.target }}</td>
                <td>{{ rsvp.from }}</td>
                <td>{{ rsvp.to }}</td>
            </tr>
            {% endfor %}

            {% if reservations|length == 0 %}
            <tr>
                <td colspan="4">
                    No reservations found.
                </td>
            </tr>
            {% endif %}
            
        </tbody>
    </table>

    {% if reservations|length == 0 %}   
    <div class="row justify-content-center">
        <div class="col-md-3">
            <button type="button" class="btn btn-primary" data-toggle="modal"
                data-target="#exampleModal">
                <i class="fa fa-plus-circle"></i> New reservation
            </button>
        </div>
    </div>
    {% endif %}


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Almost done!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                
                <form method="post">
                <div class="modal-body">
                    
                    <h6>Reservation Summary:</h6>
                    <div class="row">
                        <div class="col-md-2 font-weight-bold">Target:</div>
                        <div class="col-md-10">{{ session['target'] }}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-2 font-weight-bold">From:</div>
                        <div class="col-md-10">{{ session['from'] }}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-2 font-weight-bold">To:</div>
                        <div class="col-md-10">{{ session['to'] }}</div>
                    </div>
                    
                    
                    <h6 class="mt-4">Select your username:</h6>
                   
                    <div class="form-group">
                        <select name="username" class="form-control">
                            {% for user in users %}
                            <option>{{ user['username'] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                </div>
                <div class="modal-footer form-group">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" name="reserve" class="btn btn-primary">Confirm</button>
                </div>
                </form>
            </div>
        </div>
    </div>

    {% endif %}


</div>
{% endblock %}